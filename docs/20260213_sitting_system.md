# 앉기 기능 구현

## 작업 개요
계단/반블록에 빈 손으로 우클릭하면 앉을 수 있는 기능.
투명한 커스텀 엔티티(SeatEntity)를 생성해 플레이어가 탑승(ride)하는 방식으로 구현한다.

- JIRA: CHOCO-83
- Phase: 1.5-3

## 작업 전 요청사항
없음

## 작업 진행 중 결정된 사항등, 작업관련 주요 정보

### 앉기 방식 1: 블록 우클릭
- 빈 손(메인핸드)으로 우클릭 시에만 동작
- 웅크리기(sneak) 중이면 무시
- 이미 탑승 중이면 무시
- 해당 블록에 이미 앉아 있는 플레이어가 있으면 무시
- 대상 블록: 계단(하단), 반블록(상단/하단, 이중 제외)

### 앉기 방식 2: 바닥 앉기 (키 바인딩)
- V키 (기본값, 설정에서 변경 가능)
- 현재 위치 바닥에 앉기
- 이미 탑승 중이면 무시
- 클라이언트→서버 커스텀 패킷(SitPayload)으로 통신

### 앉는 위치
| 블록 타입 | Y 오프셋 |
|-----------|----------|
| 계단 하단 | y + 0.5 |
| 반블록 하단 | y + 0.5 |
| 반블록 상단 | y + 1.0 |
| 바닥 앉기 | 플레이어 현재 Y |

### 일어서기 / 정리
- Shift 키로 일어서기 → 엔티티 자동 제거
- 블록 파괴 시 → 앉은 엔티티 제거 (AABB 검색 영역 Y축 ±0.5 확장)
- 서버 재시작 시 → loadedFromDisk 플래그로 첫 틱에 자동 제거

### 구현 방식
- `Entity` 상속 (LivingEntity 아님 — AI/체력 불필요)
- 투명, 충돌 없음, 물리 없음
- `removePassenger()` 오버라이드로 탑승자 해제 시 자기 제거
- 바닥 앉기: `SitPayload` (커스텀 패킷) + `ModKeyBindings` (X키 바인딩)

## 작업 체크리스트
- [x] 문서 작성
- [x] SeatEntity 구현
- [x] SitHandler 구현 (우클릭 앉기 + 블록 파괴 해제)
- [x] EstherServerMod에 엔티티 타입 등록
- [x] 번역 키 추가
- [x] 빌드 확인
- [x] 바닥 앉기 구현 (SitPayload + ModKeyBindings + handleSitOnGround)

## 인게임 테스트

### 블록 앉기
- [x] 계단 빈 손 우클릭 → 앉기
- [x] 반블록(하단) 빈 손 우클릭 → 앉기
- [x] 반블록(상단) 빈 손 우클릭 → 앉기 (높은 위치)
- [x] Shift로 일어서기
- [x] 앉은 상태에서 블록 파괴 → 정상 일어서기 (계단, 반블록 하단 확인)
- [x] 앉은 상태에서 반블록(상단) 파괴 → 정상 일어서기
- [x] 아이템 들고 우클릭 → 앉기 안 됨
- [x] 웅크리기+우클릭 → 앉기 안 됨
- [x] 이미 앉은 블록에 다른 플레이어 우클릭 → 앉기 안 됨
- [x] 서버 재시작 후 좌석 엔티티 없음

### 바닥 앉기
- [x] V키 → 현재 위치에 앉기
- [x] 앉은 상태에서 Shift → 일어서기
- [x] 이미 앉은 상태에서 V키 → 무시
- [x] 키 설정에서 앉기 키 변경 가능
